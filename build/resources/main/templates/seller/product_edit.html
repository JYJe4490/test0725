<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>상품 수정</title>
  <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* ===== CSS 변수 ===== */
    :root {
      /* 색상 */
      --color-primary: #658352;
      --color-primary-hover: #94A687;
      --color-primary-light: rgba(101, 131, 82, 0.1);
      --color-white: #ffffff;
      --color-background: #FBF9EF;
      --color-text: #1E2203;
      --color-text-light: #666666;
      --color-border: #E9E7DE;
      --color-border-focus: #658352;
      --color-secondary-background: #F5F4ED;
      --color-error: #e74c3c;
      --color-success: #27ae60;
      --color-warning: #f39c12;
      
      /* 레이아웃 */
      --layout-max-width: 1400px;
      --container-max-width: 900px;
      --border-radius: 12px;
      --border-radius-large: 20px;
      --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.1);
      --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.15);
      
      /* 타이포그래피 */
      --font-family-primary: 'Inter', sans-serif;
      --font-family-heading: 'Cabin', sans-serif;
      --font-size-small: 0.875rem;
      --font-size-base: 1rem;
      --font-size-large: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 2rem;
      --font-size-4xl: 2.4rem;
      
      /* 간격 */
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-2xl: 40px;
      --spacing-3xl: 48px;
      
      /* 애니메이션 */
      --transition-fast: 0.2s;
      --transition-normal: 0.3s;
      --transition-slow: 0.5s;
    }

    /* ===== 기본 스타일 ===== */
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-family-primary);
      background-color: var(--color-background);
      color: var(--color-text);
      padding-top: 80px;
      line-height: 1.6;
      font-size: var(--font-size-base);
    }

    /* ===== 네비게이션 바 ===== */
    .navbar-container {
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      z-index: 1000;
      position: fixed;
      justify-content: center;
      background: var(--color-white);
      box-shadow: var(--shadow-light);
    }
    
    .navbar {
      width: 100%;
      display: flex;
      max-width: var(--layout-max-width);
      align-items: center;
      padding: var(--spacing-md) var(--spacing-3xl);
      justify-content: space-between;
    }
    
    .navbar-logo-img {
      height: 3rem;
      border-radius: var(--border-radius);
      transition: transform var(--transition-fast);
    }
    
    .navbar-logo-img:hover {
      transform: scale(1.05);
    }
    
    .navbar-buttons {
      gap: var(--spacing-md);
      display: flex;
      align-items: center;
    }
    
    .btn-filled, .btn-outline {
      display: flex;
      align-items: center;
      font-weight: 600;
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: 24px;
      font-size: var(--font-size-base);
      text-decoration: none;
      transition: all var(--transition-fast);
      cursor: pointer;
      border: 1px solid var(--color-primary);
      font-family: var(--font-family-primary);
    }
    
    .btn-filled {
      color: var(--color-white);
      background: var(--color-primary);
    }
    
    .btn-filled:hover {
      background: var(--color-primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-medium);
    }
    
    .btn-outline {
      color: var(--color-primary);
      background: transparent;
    }
    
    .btn-outline:hover {
      background: var(--color-primary-light);
      transform: translateY(-1px);
    }

    /* ===== 페이지 레이아웃 ===== */
    .page-container {
      width: 100%;
      max-width: var(--container-max-width);
      margin: var(--spacing-2xl) auto;
      padding: 0 var(--spacing-lg);
      box-sizing: border-box;
    }

    .page-title {
      font-family: var(--font-family-heading);
      font-weight: 700;
      color: var(--color-primary);
      text-align: center;
      font-size: var(--font-size-4xl);
      margin: 0 0 var(--spacing-xl) 0;
      position: relative;
    }
    
    .page-title::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--color-primary);
      border-radius: 2px;
    }

    /* ===== 폼 컨테이너 ===== */
    .form-container {
      background-color: var(--color-white);
      padding: var(--spacing-2xl);
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-light);
      transition: box-shadow var(--transition-normal);
    }
    
    .form-container:hover {
      box-shadow: var(--shadow-medium);
    }

    /* ===== 폼 섹션 ===== */
    .form-section {
      margin-bottom: var(--spacing-2xl);
      padding-bottom: var(--spacing-xl);
      border-bottom: 1px solid var(--color-border);
      position: relative;
    }
    
    .form-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .form-section h3 {
      font-family: var(--font-family-heading);
      font-size: var(--font-size-2xl);
      color: var(--color-primary);
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-sm);
      border-bottom: 2px solid var(--color-primary);
      display: inline-block;
      position: relative;
    }
    
    .form-section h3::before {
      content: '';
      position: absolute;
      left: 0;
      bottom: -2px;
      width: 100%;
      height: 2px;
      background: var(--color-primary-light);
      z-index: -1;
    }

    /* ===== 폼 그룹 ===== */
    .form-group {
      margin-bottom: var(--spacing-lg);
      position: relative;
    }
    
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: var(--spacing-sm);
      font-size: var(--font-size-base);
      color: var(--color-text);
      transition: color var(--transition-fast);
    }
    
    .form-group label:hover {
      color: var(--color-primary);
    }
    
    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group input[type="url"],
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-md);
      font-size: var(--font-size-base);
      border: 2px solid var(--color-border);
      border-radius: var(--border-radius);
      box-sizing: border-box;
      transition: all var(--transition-fast);
      background-color: var(--color-white);
      font-family: var(--font-family-primary);
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--color-border-focus);
      box-shadow: 0 0 0 3px var(--color-primary-light);
      transform: translateY(-1px);
    }
    
    .form-group input:hover,
    .form-group select:hover,
    .form-group textarea:hover {
      border-color: var(--color-primary-hover);
    }
    
    .form-group textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.6;
    }
    
    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: var(--color-text-light);
      opacity: 0.7;
    }
    
    /* 입력 필드 상태 */
    .form-group.error input,
    .form-group.error select,
    .form-group.error textarea {
      border-color: var(--color-error);
      box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
    }
    
    .form-group.success input,
    .form-group.success select,
    .form-group.success textarea {
      border-color: var(--color-success);
      box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
    }
    
    .form-group.warning input,
    .form-group.warning select,
    .form-group.warning textarea {
      border-color: var(--color-warning);
      box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
    }

    /* ===== 필수 입력 표시 ===== */
    .required::after {
      content: " *";
      color: var(--color-error);
      font-weight: bold;
    }

    /* ===== 에러 메시지 ===== */
    .error-message {
      color: var(--color-error);
      font-size: var(--font-size-small);
      margin-top: var(--spacing-xs);
      display: none;
      animation: slideDown var(--transition-fast) ease-out;
    }
    
    .error-message.show {
      display: block;
    }
    
    .success-message {
      color: var(--color-success);
      font-size: var(--font-size-small);
      margin-top: var(--spacing-xs);
      display: none;
    }
    
    .success-message.show {
      display: block;
    }

    /* ===== 폼 액션 버튼 ===== */
    .form-actions {
      display: flex;
      justify-content: center;
      gap: var(--spacing-md);
      margin-top: var(--spacing-2xl);
      padding-top: var(--spacing-xl);
      border-top: 1px solid var(--color-border);
    }
    
    .form-actions button {
      padding: var(--spacing-sm) var(--spacing-xl);
      font-size: var(--font-size-large);
      font-weight: 600;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 2px solid;
      min-width: 120px;
      font-family: var(--font-family-primary);
      position: relative;
      overflow: hidden;
    }
    
    .form-actions button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left var(--transition-slow);
    }
    
    .form-actions button:hover::before {
      left: 100%;
    }
    
    .submit-btn {
      background-color: var(--color-primary);
      color: var(--color-white);
      border-color: var(--color-primary);
    }
    
    .submit-btn:hover {
      background-color: var(--color-primary-hover);
      border-color: var(--color-primary-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }
    
    .submit-btn:active {
      transform: translateY(0);
    }
    
    .cancel-btn {
      background-color: transparent;
      color: var(--color-text-light);
      border-color: var(--color-border);
    }
    
    .cancel-btn:hover {
      background-color: var(--color-secondary-background);
      border-color: var(--color-text-light);
      color: var(--color-text);
      transform: translateY(-2px);
    }
    
    .cancel-btn:active {
      transform: translateY(0);
    }

    /* ===== 로딩 상태 ===== */
    .loading {
      position: relative;
      pointer-events: none;
      opacity: 0.7;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 16px;
      height: 16px;
      margin: -8px 0 0 -8px;
      border: 2px solid var(--color-primary);
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== 반응형 디자인 ===== */
    @media screen and (max-width: 768px) {
      .page-container {
        padding: 0 var(--spacing-md);
        margin: var(--spacing-lg) auto;
      }
      
      .form-container {
        padding: var(--spacing-lg) var(--spacing-md);
      }
      
      .form-section {
        margin-bottom: var(--spacing-xl);
        padding-bottom: var(--spacing-lg);
      }
      
      .form-actions {
        flex-direction: column;
        gap: var(--spacing-sm);
      }
      
      .form-actions button {
        width: 100%;
      }
      
      .page-title {
        font-size: var(--font-size-3xl);
      }
      
      .navbar {
        padding: var(--spacing-md) var(--spacing-lg);
      }
      
      .navbar-buttons {
        gap: var(--spacing-sm);
      }
      
      .btn-filled, .btn-outline {
        padding: var(--spacing-xs) var(--spacing-md);
        font-size: var(--font-size-small);
      }
    }
    
    @media screen and (max-width: 480px) {
      .page-title {
        font-size: var(--font-size-2xl);
      }
      
      .form-section h3 {
        font-size: var(--font-size-xl);
      }
      
      .form-group input,
      .form-group select,
      .form-group textarea {
        font-size: var(--font-size-base);
        padding: var(--spacing-sm);
      }
    }

    /* ===== 접근성 개선 ===== */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* 포커스 표시 개선 */
    button:focus,
    input:focus,
    select:focus,
    textarea:focus {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <!-- 네비게이션 바 -->
  <header class="navbar-container">
    <div class="navbar">
      <a th:href="@{/home}" aria-label="홈으로 이동">
        <img th:src="@{/images/free-icon-sprout-7101338.png}" alt="로고" class="navbar-logo-img"/>
      </a>
      <div class="navbar-buttons">
        <a th:if="${name != null}" th:href="@{/seller/myPage/{sid}(sid=${sid})}" style="margin-right: 12px; font-weight: bold; text-decoration: none; color: var(--color-primary);">
          <span th:text="${name}"></span>
        </a>
        <a th:href="@{/seller/main/{sid}(sid=${sid})}" class="btn-outline">대시보드</a>
        <a th:href="@{/seller/list/{sid}(sid=${sid})}" class="btn-outline">판매 목록</a>
        <form th:action="@{/seller/logout}" method="post" style="display:inline;">
          <button type="submit" class="btn-filled">로그아웃</button>
        </form>
      </div>
    </div>
  </header>

  <div class="page-container">
    <h1 class="page-title">상품 수정</h1>

    <div class="form-container">
      <form id="productEditForm" th:action="@{/seller/product/{id}/edit(id=${product.productId})}" method="post" th:object="${product}" novalidate>

        <div class="form-section">
          <h3>기본 정보</h3>
          <div class="form-group" id="productNameGroup">
            <label for="productName" class="required">상품 이름</label>
            <input type="text" id="productName" th:field="*{productName}" required>
            <div class="error-message" id="productNameError"></div>
          </div>
          <div class="form-group" id="titleGroup">
            <label for="title" class="required">고객에게 보여줄 제목</label>
            <input type="text" id="title" th:field="*{title}" required>
            <div class="error-message" id="titleError"></div>
          </div>
          <div class="form-group" id="contentGroup">
            <label for="content" class="required">상품 내용</label>
            <textarea id="content" th:field="*{content}" required></textarea>
            <div class="error-message" id="contentError"></div>
          </div>
          <div class="form-group" id="countryOfOriginGroup">
            <label for="countryOfOrigin" class="required">원산지</label>
            <input type="text" id="countryOfOrigin" th:field="*{countryOfOrigin}" required>
            <div class="error-message" id="countryOfOriginError"></div>
          </div>
        </div>

        <div class="form-section">
          <h3>판매 정보</h3>
          <div class="form-group" id="priceGroup">
            <label for="price" class="required">가격 (원)</label>
            <input type="number" id="price" th:field="*{price}" required>
            <div class="error-message" id="priceError"></div>
          </div>
          <div class="form-group" id="quantityGroup">
            <label for="quantity" class="required">수량 (재고)</label>
            <input type="number" id="quantity" th:field="*{quantity}" required>
            <div class="error-message" id="quantityError"></div>
          </div>
          <div class="form-group" id="statusGroup">
            <label for="status" class="required">판매 상태</label>
            <select id="status" th:field="*{status}" required>
              <option value="">상태를 선택하세요</option>
              <option value="판매중">판매중</option>
              <option value="재고소진">재고소진</option>
              <option value="비활성화">비활성화</option>
            </select>
            <div class="error-message" id="statusError"></div>
          </div>
        </div>

        <div class="form-section">
          <h3>이미지 등록</h3>
          <div class="form-group" id="thumbnailGroup">
            <label for="thumbnail">섬네일 사진 URL</label>
            <input type="url" id="thumbnail" th:field="*{thumbnail}" placeholder="대표 이미지 URL을 입력하세요">
            <div class="error-message" id="thumbnailError"></div>
          </div>
        </div>

        <div class="form-section">
          <h3>배송 정보</h3>
          <div class="form-group" id="deliveryFeeGroup">
            <label for="deliveryFee" class="required">배송비 (원)</label>
            <input type="number" id="deliveryFee" th:field="*{deliveryFee}" required>
            <div class="error-message" id="deliveryFeeError"></div>
          </div>
          <div class="form-group" id="deliveryMethodGroup">
            <label for="deliveryMethod">배송 방법</label>
            <textarea id="deliveryMethod" th:field="*{deliveryMethod}" rows="3" placeholder="예: CJ대한통운 (평일 오후 2시 이전 주문 시 당일 출고)"></textarea>
            <div class="error-message" id="deliveryMethodError"></div>
          </div>
          <div class="form-group" id="deliveryInformationGroup">
            <label for="deliveryInformation">배송 안내</label>
            <textarea id="deliveryInformation" th:field="*{deliveryInformation}" rows="3" placeholder="예: 제주 및 도서산간 지역은 추가 배송비가 발생할 수 있습니다."></textarea>
            <div class="error-message" id="deliveryInformationError"></div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="cancel-btn" onclick="history.back()">취소</button>
          <button type="submit" class="submit-btn" id="submitBtn">수정 완료</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ===== 상품 수정 폼 관리자 클래스 =====
    class ProductEditManager {
      constructor() {
        this.form = document.getElementById('productEditForm');
        this.submitBtn = document.getElementById('submitBtn');
        this.fields = this.initializeFields();
        this.validationRules = this.defineValidationRules();
        
        this.bindEvents();
        this.initializeForm();
      }

      // ===== 필드 초기화 =====
      initializeFields() {
        return {
          productName: {
            element: document.getElementById('productName'),
            group: document.getElementById('productNameGroup'),
            error: document.getElementById('productNameError'),
            required: true,
            minLength: 2,
            maxLength: 100
          },
          title: {
            element: document.getElementById('title'),
            group: document.getElementById('titleGroup'),
            error: document.getElementById('titleError'),
            required: true,
            minLength: 5,
            maxLength: 200
          },
          content: {
            element: document.getElementById('content'),
            group: document.getElementById('contentGroup'),
            error: document.getElementById('contentError'),
            required: true,
            minLength: 10,
            maxLength: 2000
          },
          countryOfOrigin: {
            element: document.getElementById('countryOfOrigin'),
            group: document.getElementById('countryOfOriginGroup'),
            error: document.getElementById('countryOfOriginError'),
            required: true,
            minLength: 2,
            maxLength: 50
          },
          price: {
            element: document.getElementById('price'),
            group: document.getElementById('priceGroup'),
            error: document.getElementById('priceError'),
            required: true,
            min: 0,
            max: 999999999
          },
          quantity: {
            element: document.getElementById('quantity'),
            group: document.getElementById('quantityGroup'),
            error: document.getElementById('quantityError'),
            required: true,
            min: 0,
            max: 999999
          },
          status: {
            element: document.getElementById('status'),
            group: document.getElementById('statusGroup'),
            error: document.getElementById('statusError'),
            required: true
          },
          thumbnail: {
            element: document.getElementById('thumbnail'),
            group: document.getElementById('thumbnailGroup'),
            error: document.getElementById('thumbnailError'),
            required: false,
            pattern: /^https?:\/\/.+/
          },
          deliveryFee: {
            element: document.getElementById('deliveryFee'),
            group: document.getElementById('deliveryFeeGroup'),
            error: document.getElementById('deliveryFeeError'),
            required: true,
            min: 0,
            max: 999999
          },
          deliveryMethod: {
            element: document.getElementById('deliveryMethod'),
            group: document.getElementById('deliveryMethodGroup'),
            error: document.getElementById('deliveryMethodError'),
            required: false,
            maxLength: 500
          },
          deliveryInformation: {
            element: document.getElementById('deliveryInformation'),
            group: document.getElementById('deliveryInformationGroup'),
            error: document.getElementById('deliveryInformationError'),
            required: false,
            maxLength: 500
          }
        };
      }

      // ===== 검증 규칙 정의 =====
      defineValidationRules() {
        return {
          required: (value) => value.trim() !== '' || '이 필드는 필수입니다.',
          minLength: (value, min) => value.length >= min || `최소 ${min}자 이상 입력해주세요.`,
          maxLength: (value, max) => value.length <= max || `최대 ${max}자까지 입력 가능합니다.`,
          min: (value, min) => Number(value) >= min || `최소값은 ${min}입니다.`,
          max: (value, max) => Number(value) <= max || `최대값은 ${max}입니다.`,
          pattern: (value, pattern) => pattern.test(value) || '올바른 형식이 아닙니다.',
          url: (value) => {
            if (!value) return true; // 선택사항이므로 빈 값 허용
            try {
              new URL(value);
              return true;
            } catch {
              return '올바른 URL 형식이 아닙니다.';
            }
          }
        };
      }

      // ===== 이벤트 바인딩 =====
      bindEvents() {
        // 폼 제출 이벤트
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
        
        // 실시간 검증 이벤트
        Object.values(this.fields).forEach(field => {
          if (field.element) {
            field.element.addEventListener('blur', () => this.validateField(field));
            field.element.addEventListener('input', () => this.clearFieldError(field));
            field.element.addEventListener('keypress', (e) => this.handleKeyPress(e));
          }
        });
        
        // 가격 입력 시 자동 포맷팅
        this.fields.price.element.addEventListener('input', (e) => this.formatPrice(e));
        
        // 수량 입력 시 자동 포맷팅
        this.fields.quantity.element.addEventListener('input', (e) => this.formatQuantity(e));
      }

      // ===== 폼 초기화 =====
      initializeForm() {
        // 초기 상태 설정
        Object.values(this.fields).forEach(field => {
          if (field.element) {
            this.clearFieldError(field);
          }
        });
        
        console.log('상품 수정 폼이 초기화되었습니다.');
      }

      // ===== 필드 검증 =====
      validateField(field) {
        const value = field.element.value.trim();
        const errors = [];

        // 필수 검증
        if (field.required && !this.validationRules.required(value)) {
          errors.push(this.validationRules.required(value));
        }

        // 값이 있는 경우에만 추가 검증
        if (value) {
          // 길이 검증
          if (field.minLength) {
            const result = this.validationRules.minLength(value, field.minLength);
            if (result !== true) errors.push(result);
          }
          
          if (field.maxLength) {
            const result = this.validationRules.maxLength(value, field.maxLength);
            if (result !== true) errors.push(result);
          }

          // 숫자 범위 검증
          if (field.min !== undefined) {
            const result = this.validationRules.min(value, field.min);
            if (result !== true) errors.push(result);
          }
          
          if (field.max !== undefined) {
            const result = this.validationRules.max(value, field.max);
            if (result !== true) errors.push(result);
          }

          // 패턴 검증
          if (field.pattern) {
            const result = this.validationRules.pattern(value, field.pattern);
            if (result !== true) errors.push(result);
          }

          // URL 검증
          if (field.element.type === 'url') {
            const result = this.validationRules.url(value);
            if (result !== true) errors.push(result);
          }
        }

        // 에러 표시 또는 제거
        if (errors.length > 0) {
          this.showFieldError(field, errors[0]);
          return false;
        } else {
          this.showFieldSuccess(field);
          return true;
        }
      }

      // ===== 에러 표시 =====
      showFieldError(field, message) {
        field.group.classList.remove('success');
        field.group.classList.add('error');
        field.error.textContent = message;
        field.error.classList.add('show');
      }

      // ===== 성공 표시 =====
      showFieldSuccess(field) {
        field.group.classList.remove('error');
        field.group.classList.add('success');
        field.error.classList.remove('show');
      }

      // ===== 에러 제거 =====
      clearFieldError(field) {
        field.group.classList.remove('error', 'success');
        field.error.classList.remove('show');
      }

      // ===== 전체 폼 검증 =====
      validateForm() {
        let isValid = true;
        
        Object.values(this.fields).forEach(field => {
          if (!this.validateField(field)) {
            isValid = false;
          }
        });
        
        return isValid;
      }

      // ===== 폼 제출 처리 =====
      handleSubmit(e) {
        e.preventDefault();
        
        console.log('폼 제출 시도...');
        
        if (!this.validateForm()) {
          console.log('폼 검증 실패');
          this.scrollToFirstError();
          return false;
        }
        
        console.log('폼 검증 성공, 제출 진행...');
        this.setLoadingState(true);
        
        // 실제 제출
        setTimeout(() => {
          this.form.submit();
        }, 500);
      }

      // ===== 첫 번째 에러로 스크롤 =====
      scrollToFirstError() {
        const firstError = document.querySelector('.form-group.error');
        if (firstError) {
          firstError.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          firstError.querySelector('input, select, textarea')?.focus();
        }
      }

      // ===== 로딩 상태 설정 =====
      setLoadingState(loading) {
        if (loading) {
          this.submitBtn.classList.add('loading');
          this.submitBtn.textContent = '수정 중...';
          this.submitBtn.disabled = true;
        } else {
          this.submitBtn.classList.remove('loading');
          this.submitBtn.textContent = '수정 완료';
          this.submitBtn.disabled = false;
        }
      }

      // ===== 가격 포맷팅 =====
      formatPrice(e) {
        let value = e.target.value.replace(/[^\d]/g, '');
        if (value) {
          value = parseInt(value).toLocaleString();
          e.target.value = value;
        }
      }

      // ===== 수량 포맷팅 =====
      formatQuantity(e) {
        let value = e.target.value.replace(/[^\d]/g, '');
        e.target.value = value;
      }

      // ===== 키 입력 처리 =====
      handleKeyPress(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          const nextField = this.getNextField(e.target);
          if (nextField) {
            nextField.focus();
          }
        }
      }

      // ===== 다음 필드 찾기 =====
      getNextField(currentField) {
        const fieldNames = Object.keys(this.fields);
        const currentIndex = fieldNames.findIndex(name => 
          this.fields[name].element === currentField
        );
        
        if (currentIndex < fieldNames.length - 1) {
          return this.fields[fieldNames[currentIndex + 1]].element;
        }
        
        return null;
      }
    }

    // ===== 초기화 =====
    document.addEventListener('DOMContentLoaded', () => {
      new ProductEditManager();
    });
  </script>
</body>
</html>