<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>판매자 정보 수정</title>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cabin:wght@600;700&family=Inter:wght@400;600&display=swap');
        
        /* ===== CSS 변수 정의 ===== */
        :root {
            --color-primary: #658352;
            --color-primary-hover: #94A687;
            --color-white: #ffffff;
            --color-background: #FBF9EF;
            --color-text: #1E2203;
            --color-border: #E9E7DE;
            --color-secondary-background: #F5F4ED;
            --color-secondary-text: #333;
            --color-danger: #e74c3c;
            --color-disabled: #f0f0f0;
            --color-input-border: #ccc;
            --layout-max-width: 1400px;
            --layout-radius-card: 20px;
            --layout-radius-button: 24px;
            --layout-radius-input: 8px;
            --layout-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
            --transition-default: all 0.2s ease;
        }

        /* ===== 기본 스타일 ===== */
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter', 'Cabin', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            padding-top: 80px;
            line-height: 1.6;
        }

        h2 {
            font-family: 'Cabin', sans-serif;
            font-weight: 700;
            color: var(--color-primary);
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 30px;
        }

        /* ===== 네비게이션 바 ===== */
        .navbar-container {
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            z-index: 1000;
            position: fixed;
            justify-content: center;
            background: var(--color-white);
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.06);
        }

        .navbar {
            width: 100%;
            display: flex;
            max-width: var(--layout-max-width);
            align-items: center;
            padding: 16px 48px;
            justify-content: space-between;
        }

        .navbar-logo-img {
            height: 3rem;
            border-radius: 8px;
            transition: var(--transition-default);
        }

        .navbar-logo-img:hover {
            transform: scale(1.05);
        }

        .navbar-buttons {
            gap: 16px;
            display: flex;
            align-items: center;
        }

        .btn-filled, .btn-outline {
            display: flex;
            align-items: center;
            font-weight: bold;
            padding: 10px 24px;
            border-radius: var(--layout-radius-button);
            font-size: 1rem;
            text-decoration: none;
            transition: var(--transition-default);
            cursor: pointer;
            border: 1px solid var(--color-primary);
            white-space: nowrap;
        }

        .btn-filled {
            color: var(--color-white);
            background: var(--color-primary);
        }

        .btn-filled:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-outline {
            color: var(--color-primary);
            background: transparent;
        }

        .btn-outline:hover {
            background: rgba(101, 131, 82, 0.1);
            transform: translateY(-1px);
        }

        /* ===== 폼 스타일 ===== */
        .form-container {
            background-color: var(--color-white);
            padding: 40px 50px;
            border-radius: var(--layout-radius-card);
            box-shadow: var(--layout-shadow);
            width: 100%;
            max-width: 600px;
            margin: 40px auto;
            box-sizing: border-box;
        }

        .form-row {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 18px;
        }

        label {
            width: 140px;
            font-weight: bold;
            padding-top: 10px;
            flex-shrink: 0;
            font-size: 0.95rem;
            text-align: left;
            color: var(--color-text);
        }

        .input-col {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        input, textarea {
            width: 100%;
            padding: 12px 16px;
            border-radius: var(--layout-radius-input);
            border: 1px solid var(--color-input-border);
            font-size: 1rem;
            box-sizing: border-box;
            transition: var(--transition-default);
            font-family: inherit;
        }

        input:focus, textarea:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(101, 131, 82, 0.1);
        }

        input[readonly] {
            background-color: var(--color-disabled);
            cursor: not-allowed;
            color: var(--color-text-muted);
        }

        .error-msg {
            color: var(--color-danger);
            font-size: 0.8rem;
            min-height: 1.2em;
            margin-top: 6px;
            font-weight: 500;
        }

        /* ===== 주소 검색 스타일 ===== */
        .address-search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .address-search-btn {
            padding: 12px 16px;
            font-size: 0.9rem;
            font-weight: bold;
            border-radius: var(--layout-radius-input);
            border: 1px solid var(--color-primary);
            background-color: transparent;
            color: var(--color-primary);
            cursor: pointer;
            flex-shrink: 0;
            transition: var(--transition-default);
            font-family: inherit;
        }

        .address-search-btn:hover {
            background-color: rgba(101, 131, 82, 0.1);
            transform: translateY(-1px);
        }

        /* ===== 폼 액션 버튼 ===== */
        .form-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            border-top: 1px solid var(--color-border);
            padding-top: 20px;
        }

        .form-actions a, .form-actions button {
            padding: 12px 28px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: var(--layout-radius-button);
            border: 1px solid var(--color-primary);
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition-default);
            min-width: 120px;
            font-family: inherit;
        }

        .update-btn {
            background-color: var(--color-primary);
            color: var(--color-white);
        }

        .update-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .cancel-btn {
            background-color: transparent;
            color: var(--color-primary);
            text-align: center;
        }

        .cancel-btn:hover {
            background-color: rgba(101, 131, 82, 0.1);
            transform: translateY(-1px);
        }

        /* ===== 반응형 디자인 ===== */
        @media (max-width: 768px) {
            .form-container {
                margin: 20px;
                padding: 20px;
            }

            .form-row {
                flex-direction: column;
                gap: 8px;
            }

            label {
                width: auto;
                padding-top: 0;
            }

            .address-search-container {
                flex-direction: column;
            }

            .form-actions {
                flex-direction: column;
                gap: 12px;
            }

            .form-actions a, .form-actions button {
                width: 100%;
            }

            .navbar {
                padding: 16px 20px;
            }

            .navbar-buttons {
                gap: 8px;
            }

            .btn-filled, .btn-outline {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
        }

        /* ===== 로딩 상태 ===== */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--color-primary);
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- 네비게이션 바 -->
    <header class="navbar-container">
        <div class="navbar">
            <a th:href="@{/home}">
                <img th:src="@{/images/free-icon-sprout-7101338.png}" alt="로고" class="navbar-logo-img"/>
            </a>
            <div class="navbar-buttons">
                <a th:if="${name != null}" th:href="@{/seller/info/{sid}(sid=${sellerId})}" style="margin-right: 12px; font-weight: bold; text-decoration: none; color: var(--color-primary);">
                    <span th:text="${name}"></span>
                </a>
                <a th:href="@{/seller/main/{sid}(sid=${sellerId})}" class="btn-outline">대시보드</a>
                <form th:action="@{/seller/logout}" method="post" style="display:inline;">
                    <button type="submit" class="btn-filled">로그아웃</button>
                </form>
            </div>
        </div>
    </header>

    <!-- 판매자 정보 수정 폼 -->
    <div class="form-container">
        <form th:action="@{/seller/myPage/{sid}/edit(sid=${sellerId})}" th:object="${myInformationEdit}" method="post" id="sellerEditForm">
            <h2>판매자 정보 수정</h2>

            <!-- 이메일 (읽기 전용) -->
            <div class="form-row">
                <label for="email">이메일</label>
                <div class="input-col">
                    <input type="email" th:field="*{email}" readonly>
                </div>
            </div>

            <!-- 전화번호 -->
            <div class="form-row">
                <label for="tel">전화번호</label>
                <div class="input-col">
                    <input type="text" th:field="*{tel}" maxlength="13" required>
                    <div class="error-msg" th:if="${#fields.hasErrors('tel')}" th:errors="*{tel}"></div>
                </div>
            </div>

            <!-- 사업자등록번호 (읽기 전용) -->
            <div class="form-row">
                <label for="bizRegNo">사업자등록번호</label>
                <div class="input-col">
                    <input type="text" th:field="*{bizRegNo}" readonly>
                </div>
            </div>

            <!-- 상호명 -->
            <div class="form-row">
                <label for="shopName">상호명</label>
                <div class="input-col">
                    <input type="text" th:field="*{shopName}" required>
                    <div class="error-msg" th:if="${#fields.hasErrors('shopName')}" th:errors="*{shopName}"></div>
                </div>
            </div>

            <!-- 대표자 이름 -->
            <div class="form-row">
                <label for="name">대표자 이름</label>
                <div class="input-col">
                    <input type="text" th:field="*{name}" required>
                    <div class="error-msg" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                </div>
            </div>

            <!-- 가게 주소 -->
            <div class="form-row">
                <label for="postNumber">가게 주소</label>
                <div class="input-col">
                    <div class="address-search-container">
                        <input type="text" id="postNumber" placeholder="우편번호" readonly required>
                        <button type="button" id="btn-postNumber" class="address-search-btn">주소 검색</button>
                    </div>
                    <input type="text" id="basicAddress" placeholder="주소" readonly required style="margin-bottom: 10px;">
                    <input type="text" id="detailAddress" placeholder="상세주소를 입력해주세요." required>
                    <!-- shopAddress는 hidden으로 폼 제출 시 함께 전송 -->
                    <input type="hidden" th:field="*{shopAddress}" id="shopAddress">
                </div>
            </div>

            <!-- 폼 액션 버튼 -->
            <div class="form-actions">
                <a id="cancel-btn" class="cancel-btn" th:href="@{/seller/myPage/{sid}(sid=${sellerId})}">취소</a>
                <button type="submit" id="update-btn" class="update-btn">수정</button>
            </div>
        </form>
    </div>

    <script>
        // ===== 상수 정의 =====
        const ADDRESS_FIELDS = {
            POST_NUMBER: 'postNumber',
            BASIC_ADDRESS: 'basicAddress',
            DETAIL_ADDRESS: 'detailAddress',
            SHOP_ADDRESS: 'shopAddress'
        };

        // ===== 클래스 정의 =====
        class AddressManager {
            constructor() {
                this.postNumberInput = document.getElementById(ADDRESS_FIELDS.POST_NUMBER);
                this.basicAddressInput = document.getElementById(ADDRESS_FIELDS.BASIC_ADDRESS);
                this.detailAddressInput = document.getElementById(ADDRESS_FIELDS.DETAIL_ADDRESS);
                this.shopAddressInput = document.getElementById(ADDRESS_FIELDS.SHOP_ADDRESS);
                this.searchButton = document.getElementById('btn-postNumber');
                this.form = document.getElementById('sellerEditForm');
                
                this.init();
            }

            init() {
                this.bindEvents();
                this.initializeAddressFields();
            }

            bindEvents() {
                // 주소 검색 버튼 클릭
                this.searchButton.addEventListener('click', () => this.openAddressSearch());
                
                // 폼 제출 전 주소 합치기
                this.form.addEventListener('submit', (event) => this.handleFormSubmit(event));
                
                // 상세주소 입력 시 엔터키 처리
                this.detailAddressInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') {
                        this.form.requestSubmit();
                    }
                });
            }

            initializeAddressFields() {
                // 기존 주소 데이터가 있다면 필드에 설정
                const currentAddress = this.shopAddressInput.value;
                if (currentAddress) {
                    this.parseAndSetAddress(currentAddress);
                }
            }

            openAddressSearch() {
                new daum.Postcode({
                    oncomplete: (data) => {
                        this.postNumberInput.value = data.zonecode;
                        this.basicAddressInput.value = data.roadAddress || data.jibunAddress;
                        this.detailAddressInput.focus();
                    },
                    onclose: () => {
                        // 주소 검색이 취소된 경우 처리
                        if (!this.postNumberInput.value) {
                            this.detailAddressInput.focus();
                        }
                    }
                }).open();
            }

            parseAndSetAddress(fullAddress) {
                // 주소 문자열을 파싱하여 각 필드에 설정
                const addressParts = fullAddress.split(' ');
                if (addressParts.length >= 3) {
                    this.postNumberInput.value = addressParts[0];
                    this.basicAddressInput.value = addressParts.slice(1, -1).join(' ');
                    this.detailAddressInput.value = addressParts[addressParts.length - 1];
                }
            }

            handleFormSubmit(event) {
                // 폼 유효성 검사
                if (!this.validateForm()) {
                    event.preventDefault();
                    return;
                }

                // 주소 필드 합치기
                this.combineAddress();
                
                // 로딩 상태 표시
                this.showLoading();
            }

            validateForm() {
                const requiredFields = [
                    { element: this.postNumberInput, name: '우편번호' },
                    { element: this.basicAddressInput, name: '주소' },
                    { element: this.detailAddressInput, name: '상세주소' }
                ];

                for (const field of requiredFields) {
                    if (!field.element.value.trim()) {
                        this.showError(`${field.name}을(를) 입력해주세요.`, field.element);
                        field.element.focus();
                        return false;
                    }
                }

                return true;
            }

            combineAddress() {
                const postNumber = this.postNumberInput.value.trim();
                const basicAddress = this.basicAddressInput.value.trim();
                const detailAddress = this.detailAddressInput.value.trim();

                const fullAddress = `${postNumber} ${basicAddress} ${detailAddress}`;
                this.shopAddressInput.value = fullAddress;
            }

            showError(message, element = null) {
                // 에러 메시지 표시 로직
                console.error(message);
                if (element) {
                    element.style.borderColor = 'var(--color-danger)';
                    setTimeout(() => {
                        element.style.borderColor = '';
                    }, 3000);
                }
            }

            showLoading() {
                const submitButton = document.getElementById('update-btn');
                submitButton.disabled = true;
                submitButton.textContent = '수정 중...';
                submitButton.classList.add('loading');
            }
        }

        // ===== 초기화 =====
        document.addEventListener('DOMContentLoaded', () => {
            new AddressManager();
        });
    </script>
</body>
</html> 