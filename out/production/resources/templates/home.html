<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <title>농산물 직거래 플랫폼 - 홈</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="소비자에게 신뢰할 수 있는 고품질 농산물을 제공하는 직거래 온라인 플랫폼">
  <!-- Google Fonts: Cabin, Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* ===== CSS 변수 정의 ===== */
    :root {
      --color-primary: #658352;
      --color-primary-hover: #94A687;
      --color-white: #ffffff;
      --color-background: #FBF9EF;
      --color-text: #1E2203;
      --color-border: #E9E7DE;
      --color-secondary-background: #F5F4ED;
      --color-secondary-text: #333;
      --color-danger: #dc3545;
      --layout-max-width: 1400px;
      --layout-radius-card: 8px;
      --transition-default: all 0.2s ease;
    }

    /* ===== 기본 스타일 ===== */
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Cabin', sans-serif;
      margin: 0;
      color: var(--color-text);
      background: var(--color-background);
      padding-top: 80px;
      line-height: 1.6;
    }

    /* ===== 메시지 표시 스타일 ===== */
    .message-container {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1001;
      max-width: 500px;
      width: 90%;
    }

    .message-content {
      background: var(--color-primary);
      color: var(--color-white);
      padding: 16px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: space-between;
      animation: slideDown 0.3s ease-out;
    }

    .message-close {
      background: none;
      border: none;
      color: var(--color-white);
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      margin-left: 12px;
      line-height: 1;
    }

    .message-close:hover {
      opacity: 0.8;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      to {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
    }

    /* ===== 네비게이션 바 ===== */
    .navbar-container {
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      z-index: 1000;
      position: fixed;
      justify-content: center;
      background: var(--color-white);
      box-shadow: 0 2px 12px 0 rgba(0,0,0,0.06);
    }

    .navbar {
      width: 100%;
      display: flex;
      max-width: var(--layout-max-width);
      align-items: center;
      padding: 16px 48px;
      justify-content: space-between;
    }

    .navbar-logo-img {
      height: 3rem;
      border-radius: 8px;
      transition: var(--transition-default);
    }

    .navbar-logo-img:hover {
      transform: scale(1.05);
    }

    .navbar-buttons {
      gap: 16px;
      display: flex;
      align-items: center;
    }

    .btn-filled, .btn-outline {
      display: flex;
      align-items: center;
      font-weight: bold;
      padding: 10px 24px;
      border-radius: 24px;
      font-size: 1rem;
      text-decoration: none;
      transition: var(--transition-default);
      cursor: pointer;
      border: 1px solid var(--color-primary);
      white-space: nowrap;
    }

    .btn-filled {
      color: var(--color-white);
      background: var(--color-primary);
    }

    .btn-filled:hover { 
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .btn-outline {
      color: var(--color-primary);
      background: transparent;
    }

    .btn-outline:hover { 
      background: rgba(101, 131, 82, 0.1);
      transform: translateY(-1px);
    }

    /* ===== 히어로 섹션 ===== */
    .hero-section {
      width: 100%;
      display: flex;
      position: relative;
      align-items: center;
      flex-direction: column;
      background: var(--color-secondary-background);
      padding: 64px 0 48px 0;
    }

    .hero-container {
      gap: 24px;
      width: 100%;
      display: flex;
      align-items: center;
      flex-direction: column;
      max-width: var(--layout-max-width);
      margin: 0 auto;
      padding: 0 48px;
    }

    .hero-content {
      gap: 24px;
      display: flex;
      align-items: center;
      flex-direction: column;
      margin-bottom: 18px;
      text-align: center;
    }

    .hero-title {
      font-size: 42px;
      font-family: 'Cabin', sans-serif;
      font-weight: 700;
      line-height: 1.3;
      letter-spacing: -1px;
      margin: 0;
      color: var(--color-text);
    }

    .hero-subtitle {
      font-size: 18px;
      font-family: 'Cabin', sans-serif;
      color: var(--color-secondary-text);
      line-height: 1.6;
      margin: 0;
      max-width: 600px;
    }

    /* ===== 상품 그리드 섹션 ===== */
    .products-section {
      width: 100%;
      padding: 64px 48px;
      background-color: var(--color-background);
    }

    .products-container {
      width: 100%;
      max-width: var(--layout-max-width);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .products-title {
      font-size: 32px;
      font-family: 'Cabin', sans-serif;
      font-weight: 700;
      margin-bottom: 48px;
      color: var(--color-text);
    }

    .products-grid {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 32px;
    }

    .product-card {
      text-decoration: none;
      color: var(--color-text);
      display: flex;
      flex-direction: column;
      position: relative;
      border-radius: var(--layout-radius-card);
      overflow: hidden;
      background: var(--color-white);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: var(--transition-default);
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .product-image {
      width: 100%;
      height: 250px;
      object-fit: cover;
      transition: var(--transition-default);
    }

    .product-card:hover .product-image {
      transform: scale(1.05);
    }

    .product-info {
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      flex-grow: 1;
    }

    .product-title {
      font-size: 0.95rem;
      font-weight: 500;
      line-height: 1.4;
      color: var(--color-secondary-text);
      margin-bottom: 8px;
      height: 40px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .product-price {
      margin-top: auto;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--color-text);
    }
    
    /* ===== 매진 표시 스타일 ===== */
    .sold-out-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--layout-radius-card);
      z-index: 10;
    }
    
    .sold-out-text {
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
      background: rgba(220, 53, 69, 0.9);
      padding: 8px 16px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* ===== 로딩 상태 ===== */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--color-secondary-text);
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid var(--color-border);
      border-radius: 50%;
      border-top-color: var(--color-primary);
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ===== 반응형 디자인 ===== */
    @media(max-width: 1200px) {
      .products-grid { 
        grid-template-columns: repeat(3, 1fr); 
        gap: 24px;
      }
    }

    @media(max-width: 991px) {
      .hero-section { 
        padding: 48px 0 32px 0; 
      }
      
      .hero-title {
        font-size: 36px;
      }
      
      .products-grid { 
        grid-template-columns: repeat(2, 1fr); 
        gap: 20px;
      }
      
      .products-section {
        padding: 48px 32px;
      }
    }

    @media(max-width: 767px) {
      .navbar { 
        padding: 16px 16px;
      }
      
      .hero-container {
        padding: 0 16px;
      }
      
      .hero-title {
        font-size: 28px;
      }
      
      .hero-subtitle {
        font-size: 16px;
      }
      
      .products-section { 
        padding: 32px 16px; 
      }
      
      .products-grid { 
        gap: 16px; 
      }
      
      .product-image {
        height: 200px;
      }
    }

    @media(max-width: 479px) {
      .products-grid { 
        grid-template-columns: 1fr; 
      }
      
      .hero-title {
        font-size: 24px;
      }
      
      .navbar-buttons {
        gap: 8px;
      }
      
      .btn-filled, .btn-outline {
        padding: 8px 16px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- 네비게이션 바 -->
  <header class="navbar-container">
    <div class="navbar">
      <a th:href="@{/home}">
        <img src="/images/free-icon-sprout-7101338.png" alt="농산물 직거래 플랫폼 로고" class="navbar-logo-img"/>
      </a>
      <div class="navbar-buttons">
        <!-- 구매자 로그인 상태 -->
        <th:block th:if="${buyerId != null}">
          <a th:href="@{/buyer/info}" class="btn-outline">
            <span th:text="${nickname}" style="font-weight: bold;"></span>
          </a>
          <a th:href="@{/buyer/cart/{bid}(bid=${buyerId})}" class="btn-outline">장바구니</a>
          <a href="#" onclick="logout('buyer')" class="btn-filled">로그아웃</a>
        </th:block>
        
        <!-- 판매자 로그인 상태 -->
        <th:block th:if="${sellerId != null}">
          <a th:href="@{/seller/myPage/{sid}(sid=${sellerId})}" class="btn-outline">
            <span th:text="${nickname}" style="font-weight: bold;"></span>
          </a>
          <a th:href="@{/seller/main/{sid}(sid=${sellerId})}" class="btn-outline">대시보드</a>
          <a href="#" onclick="logout('seller')" class="btn-filled">로그아웃</a>
        </th:block>

        <!-- 비로그인 상태 -->
        <th:block th:if="${buyerId == null and sellerId == null}">
          <a th:href="@{/common/select_login}" class="btn-outline">로그인</a>
          <a th:href="@{/common/select_signup}" class="btn-filled">회원가입</a>
        </th:block>
      </div>
    </div>
  </header>

  <!-- 메시지 표시 영역 -->
  <div th:if="${msg}" class="message-container">
    <div class="message-content">
      <span th:text="${msg}"></span>
      <button class="message-close" onclick="this.parentElement.parentElement.remove()">×</button>
    </div>
  </div>

  <!-- 히어로 섹션 -->
  <section class="hero-section">
    <div class="hero-container">
      <div class="hero-content">
        <h1 class="hero-title">소비자에게 신뢰할 수 있는 고품질 농산물을 제공하는 직거래 온라인 플랫폼</h1>
        <p class="hero-subtitle">농사를 즐겁게, 소비를 이롭게</p>
      </div>
    </div>
  </section>

  <!-- 상품 그리드 섹션 -->
  <section class="products-section">
    <div class="products-container">
      <h2 class="products-title">최신 상품</h2>
      <div class="products-grid" id="productsGrid">
        <!-- 상품이 없을 때 -->
        <div th:if="${#lists.isEmpty(products)}" class="loading">
          등록된 상품이 없습니다.
        </div>
        
        <!-- 상품 카드 -->
        <a th:each="product : ${products}"
           th:href="@{/seller/product/{pid}(pid=${product.productId})}"
           class="product-card"
           th:title="${product.title}">
          <img th:src="${product.thumbnail}" 
               th:alt="${product.title}"
               class="product-image"
               th:onerror="this.src='/images/default-product.jpg'">
          
          <!-- 재고소진 상품에 매진 표시 -->
          <div th:if="${product.status == '재고소진'}" class="sold-out-overlay">
            <span class="sold-out-text">매진</span>
          </div>
          
          <div class="product-info">
            <p class="product-title" th:text="${product.title}"></p>
            <p class="product-price" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + '원'"></p>
          </div>
        </a>
      </div>
    </div>
  </section>

  <script>
    /**
     * 로그아웃 처리 함수
     * @param {string} type - 로그아웃 타입 ('buyer' 또는 'seller')
     */
    function logout(type) {
      if (!confirm('로그아웃 하시겠습니까?')) {
        return;
      }

      const form = document.createElement('form');
      form.method = 'POST';
      form.action = `/${type}/logout`;

      // CSRF 토큰 처리
      const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
      if (csrfToken) {
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = '_csrf';
        csrfInput.value = csrfToken;
        form.appendChild(csrfInput);
      }

      document.body.appendChild(form);
      form.submit();
    }

    /**
     * 페이지 로드 완료 후 실행되는 초기화 함수
     */
    document.addEventListener('DOMContentLoaded', function() {
      // 메시지 자동 숨김 (5초 후)
      const messageContainer = document.querySelector('.message-container');
      if (messageContainer) {
        setTimeout(() => {
          messageContainer.style.animation = 'slideUp 0.3s ease-out';
          setTimeout(() => {
            messageContainer.remove();
          }, 300);
        }, 5000);
      }

      // 이미지 로드 실패 시 기본 이미지로 대체
      const images = document.querySelectorAll('.product-image');
      images.forEach(img => {
        img.addEventListener('error', function() {
          this.src = '/images/default-product.jpg';
          this.alt = '상품 이미지';
        });
      });

      // 상품 카드 클릭 시 로딩 표시
      const productCards = document.querySelectorAll('.product-card');
      productCards.forEach(card => {
        card.addEventListener('click', function() {
          // 로딩 표시 (선택사항)
          this.style.opacity = '0.7';
        });
      });
    });

    /**
     * 페이지 가시성 변경 시 처리
     */
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible') {
        // 페이지가 다시 보일 때 필요한 처리
        console.log('페이지가 다시 활성화되었습니다.');
      }
    });
  </script>
</body>
</html>